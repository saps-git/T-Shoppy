{"ast":null,"code":"var _jsxFileName = \"/home/saptarshi/Projects/tshoppy/frontend/ecom/src/core/PaymentB.js\";\nimport React, { useState, useEffect } from \"react\";\nimport { Redirect } from \"react-router-dom\";\nimport { cartEmpty } from \"./helper/cartHelper\";\nimport { getmeToken, processPayment } from \"./helper/paymentHelper\";\nimport { createOrder } from \"./helper/orderHelper\";\nimport { isAuthenticated, signout } from \"../auth/helper\";\nimport DropIn from \"braintree-web-drop-in-react\";\n\nconst PaymentB = ({\n  products,\n  reload = undefined,\n  setReload = f => f\n}) => {\n  const [info, setInfo] = useState({\n    loading: false,\n    success: false,\n    clientToken: null,\n    error: \"\",\n    instance: {}\n  });\n  const userId = isAuthenticated && isAuthenticated().user.id;\n  const token = isAuthenticated && isAuthenticated().token;\n\n  const getToken = (userId, token) => {\n    getmeToken(userId, token).then(info => {\n      if (info.error) {\n        setInfo({ ...info,\n          error: info.error\n        });\n        signout(() => {\n          return /*#__PURE__*/React.createElement(Redirect, {\n            to: \"/\",\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 35,\n              columnNumber: 20\n            }\n          });\n        });\n      } else {\n        const clientToken = info.clientToken;\n        setInfo({\n          clientToken\n        });\n      }\n    });\n  };\n\n  useEffect(() => {\n    getToken(userId, token);\n  }, []);\n\n  const getAmount = () => {\n    let amount = 0;\n    products.map(p => {\n      amount = amount + parseInt(p.price);\n    });\n    return amount;\n  };\n\n  const onPurchase = () => {\n    setInfo({\n      loading: true\n    });\n    let nonce;\n    let getNonce = info.instance.requestPaymentMethod().then(data => {\n      console.log(\"MYDATA\", data);\n      nonce = data.nonce;\n      const paymentData = {\n        paymentMethodNonce: nonce,\n        amount: getAmount()\n      };\n      processPayment(userId, token, paymentData).then(response => {\n        console.log(\"POINT-1\", response);\n\n        if (response.error) {\n          if (response.code === \"1\") {\n            console.log(\"PAYMENT Failed!\");\n            signout(() => {\n              return /*#__PURE__*/React.createElement(Redirect, {\n                to: \"/\",\n                __self: this,\n                __source: {\n                  fileName: _jsxFileName,\n                  lineNumber: 72,\n                  columnNumber: 24\n                }\n              });\n            });\n          }\n        } else {\n          setInfo({ ...info,\n            success: response.success,\n            loading: false\n          });\n          console.log(\"PAYMENT SUCCESS\");\n          let product_names = \"\";\n          products.forEach(function (item) {\n            product_names += item.name + \", \";\n          });\n          const orderData = {\n            products: product_names,\n            transaction_id: response.transaction.id,\n            amount: response.transaction.amount\n          };\n          createOrder(userId, token, orderData).then(response => {\n            if (response.error) {\n              if (response.code === \"1\") {\n                console.log(\"Order Failed!\");\n                signout(() => {\n                  return /*#__PURE__*/React.createElement(Redirect, {\n                    to: \"/\",\n                    __self: this,\n                    __source: {\n                      fileName: _jsxFileName,\n                      lineNumber: 95,\n                      columnNumber: 30\n                    }\n                  });\n                });\n              }\n            } else {\n              if (response.success == true) {\n                console.log(\"ORDER PLACED!!\");\n              }\n            }\n          }).catch(error => {\n            setInfo({\n              loading: false,\n              success: false\n            });\n            console.log(\"Order FAILED\", error);\n          });\n          cartEmpty(() => {\n            console.log(\"Did we got a crash?\");\n          });\n          setReload(!reload);\n        }\n      }).catch(error => {\n        setInfo({\n          loading: false,\n          success: false\n        });\n        console.log(\"PAYMENT FAILED\", error);\n      });\n    });\n  };\n\n  const showbtnDropIn = () => {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 124,\n        columnNumber: 7\n      }\n    }, info.clientToken !== null && products.length > 0 ? /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 127,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(DropIn, {\n      options: {\n        authorization: info.clientToken\n      },\n      onInstance: instance => info.instance = instance,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 128,\n        columnNumber: 15\n      }\n    }), /*#__PURE__*/React.createElement(\"button\", {\n      onClick: onPurchase,\n      className: \"btn btn-block btn-success\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 133,\n        columnNumber: 15\n      }\n    }, \"Buy Now\")) : /*#__PURE__*/React.createElement(\"h3\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 142,\n        columnNumber: 13\n      }\n    }, \"Please login first or add something in cart\"));\n  };\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 149,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"h3\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 150,\n      columnNumber: 7\n    }\n  }, \"Your bill is $ \", getAmount()), showbtnDropIn());\n};\n\nexport default PaymentB;","map":{"version":3,"sources":["/home/saptarshi/Projects/tshoppy/frontend/ecom/src/core/PaymentB.js"],"names":["React","useState","useEffect","Redirect","cartEmpty","getmeToken","processPayment","createOrder","isAuthenticated","signout","DropIn","PaymentB","products","reload","undefined","setReload","f","info","setInfo","loading","success","clientToken","error","instance","userId","user","id","token","getToken","then","getAmount","amount","map","p","parseInt","price","onPurchase","nonce","getNonce","requestPaymentMethod","data","console","log","paymentData","paymentMethodNonce","response","code","product_names","forEach","item","name","orderData","transaction_id","transaction","catch","showbtnDropIn","length","authorization"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport { Redirect } from \"react-router-dom\";\nimport { cartEmpty } from \"./helper/cartHelper\";\nimport { getmeToken, processPayment } from \"./helper/paymentHelper\";\nimport { createOrder } from \"./helper/orderHelper\";\nimport { isAuthenticated, signout } from \"../auth/helper\";\n\nimport DropIn from \"braintree-web-drop-in-react\";\n\nconst PaymentB = ({\n  products,\n  reload = undefined,\n  setReload = (f) => f,\n}) => {\n  const [info, setInfo] = useState({\n    loading: false,\n    success: false,\n    clientToken: null,\n    error: \"\",\n    instance: {},\n  });\n\n  const userId = isAuthenticated && isAuthenticated().user.id;\n  const token = isAuthenticated && isAuthenticated().token;\n\n  const getToken = (userId, token) => {\n    getmeToken(userId, token)\n      .then((info) => {\n        if (info.error) {\n          setInfo({\n            ...info,\n            error: info.error,\n          });\n          signout(() => {\n            return <Redirect to=\"/\" />;\n          });\n        } else {\n          const clientToken = info.clientToken;\n          setInfo({ clientToken });\n        }\n      });\n  };\n\n  useEffect(() => {\n    getToken(userId, token);\n  }, []);\n\n  const getAmount = () => {\n    let amount = 0;\n    products.map((p) => {\n      amount = amount + parseInt(p.price);\n    });\n    return amount;\n  };\n  const onPurchase = () => {\n    setInfo({ loading: true });\n    let nonce;\n    let getNonce = info.instance.requestPaymentMethod().then((data) => {\n      console.log(\"MYDATA\", data);\n      nonce = data.nonce;\n      const paymentData = {\n        paymentMethodNonce: nonce,\n        amount: getAmount(),\n      };\n      processPayment(userId, token, paymentData)\n        .then((response) => {\n          console.log(\"POINT-1\", response);\n          if (response.error) {\n            if (response.code === \"1\") {\n              console.log(\"PAYMENT Failed!\");\n              signout(() => {\n                return <Redirect to=\"/\" />;\n              });\n            }\n          } else {\n            setInfo({ ...info, success: response.success, loading: false });\n            console.log(\"PAYMENT SUCCESS\");\n\n            let product_names = \"\";\n            products.forEach(function (item) {\n              product_names += item.name + \", \";\n            });\n\n            const orderData = {\n              products: product_names,\n              transaction_id: response.transaction.id,\n              amount: response.transaction.amount,\n            };\n            createOrder(userId, token, orderData)\n              .then((response) => {\n                if (response.error) {\n                  if (response.code === \"1\") {\n                    console.log(\"Order Failed!\");\n                    signout(() => {\n                      return <Redirect to=\"/\" />;\n                    });\n                  }\n                } else {\n                  if (response.success == true) {\n                    console.log(\"ORDER PLACED!!\");\n                  }\n                }\n              })\n              .catch((error) => {\n                setInfo({ loading: false, success: false });\n                console.log(\"Order FAILED\", error);\n              });\n            cartEmpty(() => {\n              console.log(\"Did we got a crash?\");\n            });\n\n            setReload(!reload);\n          }\n        })\n        .catch((error) => {\n          setInfo({ loading: false, success: false });\n          console.log(\"PAYMENT FAILED\", error);\n        });\n    });\n  };\n\n  const showbtnDropIn = () => {\n    return (\n      <div>\n        {info.clientToken !== null && products.length > 0\n          ? (\n            <div>\n              <DropIn\n                options={{ authorization: info.clientToken }}\n                onInstance={(instance) => (info.instance = instance)}\n              >\n              </DropIn>\n              <button\n                onClick={onPurchase}\n                className=\"btn btn-block btn-success\"\n              >\n                Buy Now\n              </button>\n            </div>\n          )\n          : (\n            <h3>Please login first or add something in cart</h3>\n          )}\n      </div>\n    );\n  };\n\n  return (\n    <div>\n      <h3>Your bill is $ {getAmount()}</h3>\n      {showbtnDropIn()}\n    </div>\n  );\n};\n\nexport default PaymentB;\n"]},"metadata":{},"sourceType":"module"}